# OS配置
## Power Options

^9fe721

```SQL
DECLARE @PowerProfile VARCHAR(100);
EXEC xp_instance_regread N'HKEY_LOCAL_MACHINE',
                         N'SYSTEM\CurrentControlSet\Control\Power\User\PowerSchemes',
                         N'ActivePowerScheme',
                         @PowerProfile OUTPUT;

SELECT CASE @PowerProfile
           WHEN '381b4222-f694-41f0-9685-ff5bb260df2e' THEN
               'Current Power Profile = Balanced'
           WHEN 'a1841308-3541-4fab-bc81-f71556f20b4a' THEN
               'Current Power Profile = Power Saver'
           WHEN '8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c' THEN
               'Current Power Profile = High Performance'
           ELSE
               'Current Power Profile = NOT Recognised'
       END PowerProfile,
       CASE @PowerProfile
           WHEN '381b4222-f694-41f0-9685-ff5bb260df2e' THEN
               0
           WHEN 'a1841308-3541-4fab-bc81-f71556f20b4a' THEN
               1
           WHEN '8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c' THEN
               2
           ELSE
               -1
       END PowerProfileValue;
```

```SQL
DECLARE @isCmdShellEnabled BIT;
DECLARE @isShowAdvanced BIT;
SELECT
@isCmdShellEnabled = CAST(value AS BIT)
FROM
sys.configurations
WHERE
name = 'xp_cmdshell';
SELECT
@isShowAdvanced = CAST(value AS BIT)
FROM
sys.configurations
WHERE
name = 'show advanced options';
IF(@isShowAdvanced = 0)
BEGIN
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
END;
IF(@isCmdShellEnabled = 0)
BEGIN
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
END;
--Run xp_cmdshell to get power settings
EXEC xp_cmdshell 'powercfg /list';
--Turn off 'xp_cmdshell'
IF(@isCmdShellEnabled = 0)
BEGIN
EXEC sp_configure 'xp_cmdshell', 0;
RECONFIGURE;
END;
--Turn off 'show advanced options'
IF(@isShowAdvanced = 0)
BEGIN
EXEC sp_configure 'show advanced options', 0;
RECONFIGURE;
END;
```


## Windows Info
```SQL
SELECT windows_release as [操作系统版本], windows_service_pack_level as [SP], 
       windows_sku, os_language_version
FROM sys.dm_os_windows_info WITH (NOLOCK) OPTION (RECOMPILE);
```

[操作系统版本](https://docs.microsoft.com/zh-cn/windows/win32/sysinfo/operating-system-version) ^21b48b


## CPU 

^2220af
#CPU 
```SQL
EXEC sys.xp_instance_regread N'HKEY_LOCAL_MACHINE', N'HARDWARE\DESCRIPTION\System\CentralProcessor\0', N'ProcessorNameString';
```

## Numa Node

^76c006

```SQL
SELECT node_id, node_state_desc, memory_node_id, processor_group, cpu_count, online_scheduler_count, 
       idle_scheduler_count, active_worker_count, avg_load_balance, resource_monitor_state
FROM sys.dm_os_nodes WITH (NOLOCK) 
WHERE node_state_desc <> N'ONLINE DAC' OPTION (RECOMPILE);
```